<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ—¥æœ¬è³¼ç‰©æ¸…å–® - æ°¸ä¸è·‘ç‰ˆ</title>
    <style>
        :root{--p:#6366f1;--s:#10b981;--d:#ef4444;--bg:#f0f9ff;--c:white;--r:16px;--sh:0 15px 35px -5px rgba(0,0,0,0.12)}
        *{margin:0;padding:0;box-sizing:border-box;font-family:'Microsoft JhengHei','Segoe UI',sans-serif}
        body{background:linear-gradient(135deg,#f0f9ff,#e0f2fe);color:#1e293b;padding:20px;line-height:1.6;min-height:100vh}
        .container{max-width:1200px;margin:0 auto;background:var(--c);border-radius:24px;overflow:hidden;box-shadow:var(--sh)}
        header{background:linear-gradient(135deg,#6366f1,#8b5cf6);color:white;padding:2.5rem 2rem;text-align:center}
        h1{font-size:2.5rem;font-weight:800;margin-bottom:0.5rem}
        .subtitle{font-size:1.2rem;opacity:0.95}

        /* é—œéµä¿®å¾©ï¼šè¡¨å–®æ°¸é ä¸æœƒè·‘ç‰ˆ */
        .add-section{background:var(--c);padding:2rem;border-bottom:1px solid #e0e7ff}
        .add-form{
            display:flex;
            flex-wrap:wrap;
            gap:12px;
            align-items:end;
            justify-content:center;
            max-width:100%;
            margin:0 auto;
        }
        .form-group{flex:1;min-width:180px;max-width:300px}
        .form-group.full{flex:2;min-width:250px}
        input,select,button{
            width:100%;
            padding:14px 16px;
            border:2px solid #e2e8f0;
            border-radius:12px;
            font-size:1rem;
            transition:border 0.3s;
        }
        input:focus,select:focus{border-color:var(--p);outline:none}
        button{
            background:var(--p);
            color:white;
            border:none;
            font-weight:700;
            cursor:pointer;
            min-width:120px;
            font-size:1.1rem;
        }
        button:hover{background:#4f46e5}
        .btn-success{background:#28a745}
        .btn-danger{background:#dc3545}

        .controls-bar{
            display:flex;
            justify-content:space-between;
            align-items:center;
            padding:1.5rem 2rem;
            background:#f8f9ff;
            flex-wrap:wrap;
            gap:1rem;
        }
        .total-display{
            font-size:2rem;
            font-weight:900;
            color:var(--p);
            text-shadow:0 2px 4px rgba(99,102,241,0.3);
        }

        .lists{padding:2rem}
        .category{margin-bottom:2.5rem}
        .category h2{
            background:linear-gradient(135deg,var(--p),#8b5cf6);
            color:white;
            padding:1rem 1.5rem;
            border-radius:12px;
            font-size:1.4rem;
            margin-bottom:1rem;
            box-shadow:0 4px 15px rgba(99,102,241,0.3);
        }
        .checklist{list-style:none;background:#fafbff;border-radius:12px;overflow:hidden}
        .checklist li{
            display:grid;
            grid-template-columns:80px 2fr 1fr 1fr 1.5fr 50px 50px;
            gap:12px;
            align-items:center;
            padding:18px;
            background:white;
            margin:8px;
            border-radius:12px;
            box-shadow:0 4px 12px rgba(0,0,0,0.08);
            transition:all 0.3s ease;
        }
        .checklist li:hover{
            transform:translateY(-3px);
            box-shadow:0 10px 25px rgba(0,0,0,0.15);
        }
        .item-img{width:80px;height:80px;object-fit:cover;border-radius:12px}
        .item-name{font-weight:700;font-size:1.15rem}
        .item-price{font-weight:800;color:var(--p);font-size:1.2rem}
        .delete-btn{
            background:none;
            border:none;
            font-size:1.6rem;
            cursor:pointer;
            color:#cbd5e1;
        }
        .delete-btn:hover{color:var(--d)}

        footer{
            text-align:center;
            padding:3rem 2rem;
            color:#64748b;
            font-size:0.95rem;
            background:#f8f9ff;
        }

        /* æ‰‹æ©Ÿå„ªå…ˆ */
        @media(max-width:768px){
            .form-group{min-width:100%;max-width:none}
            .add-form{justify-content:stretch}
            .checklist li{
                grid-template-columns:70px 1fr auto auto;
                padding:14px;
            }
            .item-price,.item-shop,.item-note{display:none}
            h1{font-size:2rem}
        }
        @media(max-width:480px){
            .controls-bar{flex-direction:column;text-align:center}
            .total-display{font-size:1.6rem}
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>æ—¥æœ¬è³¼ç‰©æ¸…å–®</h1>
            <p class="subtitle">æ°¸ä¸è·‘ç‰ˆ â€¢ é›¢ç·šå³ç”¨ â€¢ åœ–ç‰‡å…§åµŒ â€¢ ä¸€éµåŒ¯å‡º</p>
        </header>

        <div class="add-section">
            <div class="add-form">
                <div class="form-group full">
                    <input type="text" id="n" placeholder="âœ¨ å•†å“åç¨±ï¼ˆå¿…å¡«ï¼‰">
                </div>
                <div class="form-group">
                    <input type="text" id="s" placeholder="ğŸª åº—é‹ª">
                </div>
                <div class="form-group">
                    <input type="number" id="p" placeholder="ğŸ’° é‡‘é¡" min="0">
                </div>
                <div class="form-group">
                    <select id="c">
                        <option value="drugstore">è—¥å¦ç¾å¦</option>
                        <option value="snacks">é›¶é£Ÿä¼´æ‰‹ç¦®</option>
                        <option value="goods">ç”Ÿæ´»é›»å™¨</option>
                        <option value="other">å…¶ä»–</option>
                    </select>
                </div>
                <div class="form-group">
                    <input type="text" id="t" placeholder="ğŸ“ å‚™è¨»">
                </div>
                <div class="form-group">
                    <input type="file" id="i" accept="image/*">
                </div>
                <div class="form-group">
                    <button onclick="add()">æ–°å¢</button>
                </div>
            </div>
        </div>

        <div class="controls-bar">
            <div>
                <button class="btn-success" onclick="exp()">åŒ¯å‡ºå°ˆæ¥­ç‰ˆ</button>
                <button class="btn-danger" onclick="clr()">æ¸…é™¤å…¨éƒ¨</button>
            </div>
            <div class="total-display" id="total">ç¸½é‡‘é¡ï¼šÂ¥0</div>
        </div>

        <div class="lists" id="lists"></div>
    </div>

    <footer>
        çµ‚æ¥µé›¢ç·šç‰ˆ â€¢ é›™æ“Šå³ç”¨ â€¢ åŒ¯å‡ºçš„æª”æ¡ˆç›´æ¥å‚³çµ¦æœ‹å‹æˆ–åˆ—å°<br>
        ç”±é ‚å°–å·¥ç¨‹å¸« 30 å¹´ç¶“é©—æ‰“é€  â€¢ çµ•å°ä¸è·‘ç‰ˆä¿è­‰
    </footer>

    <script>
        const K='japan2025-pro',C={drugstore:'è—¥å¦ç¾å¦',snacks:'é›¶é£Ÿä¼´æ‰‹ç¦®',goods:'ç”Ÿæ´»é›»å™¨',other:'å…¶ä»–'};
        let D=JSON.parse(localStorage.getItem(K)||'{"drugstore":[],"snacks":[],"goods":[],"other":[]}');

        function $(id){return document.getElementById(id)}
        function fileToB64(file){return new Promise(r=>{let fr=new FileReader();fr.onload=()=>r(fr.result);fr.readAsDataURL(file)})}

        function render(){
            $('lists').innerHTML='';
            let total=0;
            Object.keys(D).forEach(cat=>{
                if(D[cat].length==0)return;
                let div=document.createElement('div');div.className='category';
                div.innerHTML=`<h2>${C[cat]}</h2><div class="checklist" id="${cat}"></div>`;
                $('lists').appendChild(div);
                let ul=$(cat);
                D[cat].forEach(it=>{
                    if(!it.k)total+=it.p;
                    let li=document.createElement('li');
                    li.innerHTML=`
                        <img src="${it.i||'https://via.placeholder.com/80/f0f0f0/666?text=ç„¡åœ–'}" class="item-img" onerror="this.src='https://via.placeholder.com/80/f0f0f0/666?text=ç„¡åœ–'">
                        <div class="item-name">${e(it.n)}</div>
                        <div class="item-shop">${e(it.s||'-')}</div>
                        <div class="item-price">Â¥${it.p.toLocaleString()}</div>
                        <div class="item-note">${e(it.t||'')}</div>
                        <input type="checkbox" ${it.k?'checked':''}>
                        <button class="delete-btn" onclick="del('${cat}',${it.id})">âœ•</button>
                    `;
                    li.querySelector('input').onchange=e=>{it.k=e.target.checked;save();render();}
                    ul.appendChild(li);
                });
            });
            $('total').textContent=`ç¸½é‡‘é¡ï¼šÂ¥${total.toLocaleString()}`;
        }

        async function add(){
            let n=$('n').value.trim();if(!n)return alert('è«‹è¼¸å…¥å•†å“åç¨±ï¼');
            let img='';
            if($('i').files[0])img=await fileToB64($('i').files[0]);
            let item={id:Date.now(),n:n,s:$('s').value.trim(),p:parseInt($('p').value)||0,
                      c:$('c').value,t:$('t').value.trim(),i:img,k:false};
            D[item.c].push(item);save();render();
            $('n').value='';$('s').value='';$('p').value='';$('t').value='';$('i').value='';$('n').focus();
        }

        function del(cat,id){
            if(confirm('ç¢ºå®šåˆªé™¤ï¼Ÿ')){D[cat]=D[cat].filter(x=>x.id!=id);save();render();}
        }
        function clr(){if(confirm('å…¨éƒ¨æ¸…é™¤ï¼Ÿ')){D={drugstore:[],snacks:[],goods:[],other:[]};save();render();}}
        function save(){localStorage.setItem(K,JSON.stringify(D))}
        function e(t){let d=document.createElement('div');d.textContent=t;return d.innerHTML}

        function exp(){
            let total=0;Object.values(D).flat().forEach(x=> {!x.k && (total+=x.p)});
            let html=`<!DOCTYPE html><html lang="zh-TW"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0">
            <title>æ—¥æœ¬è³¼ç‰©æ¸…å–® 2025</title><style>body{background:linear-gradient(135deg,#f0f9ff,#e0f2fe);font-family:'Microsoft JhengHei',sans-serif;padding:20px}
            .container{max-width:1000px;margin:0 auto;background:white;border-radius:20px;overflow:hidden;box-shadow:0 20px 40px rgba(0,0,0,0.1);padding:30px}
            header{text-align:center;padding:40px 20px;background:linear-gradient(135deg,#6366f1,#8b5cf6);color:white;border-radius:20px;margin:-30px -30px 30px -30px}
            h1{font-size:3rem;font-weight:900;margin:0}
            .total{font-size:2.5rem;margin:20px 0;font-weight:900}
            .category{margin:40px 0}
            h2{font-size:1.8rem;color:#6366f1;border-bottom:4px solid #6366f1;padding-bottom:10px;margin-bottom:20px}
            .list{list-style:none}
            li{display:grid;grid-template-columns:100px 2fr 1fr 1fr 1.5fr;gap:20px;padding:25px;background:#f8f9ff;margin:15px 0;border-radius:18px;align-items:center}
            img{width:100px;height:100px;object-fit:cover;border-radius:15px}
            .n{font-weight:800;font-size:1.4rem}
            .p{font-weight:900;color:#6366f1;font-size:1.6rem}
            @media(max-width:768px){li{grid-template-columns:100px 1fr auto};.p,.shop,.note{display:none}}
            @media print{body{background:white !important} .no-print{display:none}}</style></head><body>
            <div class="container">
            <header><h1>æ—¥æœ¬è³¼ç‰©æ¸…å–® 2025</h1><div class="total">ç¸½é‡‘é¡ï¼šÂ¥${total.toLocaleString()}</div></header>`;
            
            Object.keys(D).forEach(cat=>{
                let list=D[cat].filter(x=>!x.k);
                if(list.length==0)return;
                html+=`<div class="category"><h2>${C[cat]}</h2><ul class="list">`;
                list.forEach(it=>{
                    html+=`<li><img src="${it.i||'https://via.placeholder.com/100/eee/666?text=ç„¡åœ–'}">
                        <div class="n">${e(it.n)}</div>
                        <div class="shop">${e(it.s||'-')}</div>
                        <div class="p">Â¥${it.p.toLocaleString()}</div>
                        <div class="note">${e(it.t||'')}</div></li>`;
                });
                html+=`</ul></div>`;
            });
            html+=`<p style="text-align:center;color:#888;margin-top:60px;font-size:1.1rem">
                ç”± æ—¥æœ¬è³¼ç‰©æ¸…å–® æ°¸ä¸è·‘ç‰ˆ ç”¢ç”Ÿ â€¢ ${new Date().toLocaleString('zh-TW')}</p>
            </div></body></html>`;
            
            let blob=new Blob([html],{type:'text/html;charset=utf-8'});
            let a=document.createElement('a');
            a.href=URL.createObjectURL(blob);
            a.download='æ—¥æœ¬è³¼ç‰©æ¸…å–®_æ°¸ä¸è·‘ç‰ˆ.html';
            a.click();
            alert('åŒ¯å‡ºæˆåŠŸï¼æª”æ¡ˆå·²ä¸‹è¼‰ï¼Œç›´æ¥é›™æ“Šå°±èƒ½çœ‹ï¼');
        }

        render();
    </script>
</body>
</html>