<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>大阪自由行 - 打地鼠 | Travel Itinerary</title>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="style.css">
</head>
<body class="antialiased min-h-screen flex justify-center bg-[#F5F5F0]">

    <div id="app" class="w-full max-w-md md:max-w-xl min-h-screen relative pb-32">
        <input type="file" ref="fileInput" @change="handleFileUpload" class="hidden" accept=".json">
        <input type="file" ref="imageInput" @change="handleImageUpload" class="hidden" accept="image/*">

        <header class="fixed top-0 left-0 right-0 z-50 bg-gradient-to-r from-[#9FB3C8]/95 to-[#8CA6A4]/95 backdrop-blur-ios transition-all duration-300 shadow-sm border-b border-white/10">
            <div class="max-w-md md:max-w-xl mx-auto px-5 py-4">
                <div class="flex justify-between items-center mb-5">
                    <div>
                        <h1 class="text-2xl font-bold tracking-tight text-white shadow-sm">大阪自由行</h1>
                        <div class="flex items-center gap-2">
                            <p class="text-xs font-medium text-white/80 uppercase tracking-widest mt-0.5">Project: 打地鼠</p>
                            <span class="text-[9px] px-1.5 py-0.5 rounded bg-white/20 text-white backdrop-blur-sm border border-white/10 animate-pulse" v-if="syncStatus !== '已同步'">{{ syncStatus }}</span>
                            <span class="text-[9px] px-1.5 py-0.5 rounded bg-green-400/80 text-white backdrop-blur-sm border border-white/10" v-else><i class="fa-solid fa-cloud-check mr-1"></i>已同步</span>
                        </div>
                    </div>
                    <div class="flex items-center space-x-3">
                        <template v-if="isEditMode">
                            <button @click="triggerImport" class="w-9 h-9 rounded-full bg-white/20 text-white flex items-center justify-center ios-btn-active backdrop-blur-sm border border-white/20"><i class="fa-solid fa-file-import text-sm"></i></button>
                            <button @click="exportData" class="w-9 h-9 rounded-full bg-white/20 text-white flex items-center justify-center ios-btn-active backdrop-blur-sm border border-white/20"><i class="fa-solid fa-download text-sm"></i></button>
                            <button @click="resetData" class="w-9 h-9 rounded-full bg-red-500/80 text-white flex items-center justify-center ios-btn-active backdrop-blur-sm shadow-md"><i class="fa-solid fa-rotate-left text-sm"></i></button>
                        </template>
                        <button @click="toggleEditMode" class="w-10 h-10 rounded-full flex items-center justify-center transition-all ios-btn-active shadow-sm border border-white/20" :class="isEditMode ? 'bg-[#4A5568] text-white' : 'bg-white/20 text-white backdrop-blur-md'"><i class="fa-solid text-base" :class="isEditMode ? 'fa-check' : 'fa-pen'"></i></button>
                    </div>
                </div>
                <div class="bg-black/10 p-1.5 rounded-2xl flex mb-0 backdrop-blur-sm">
                    <button @click="currentView = 'itinerary'" class="flex-1 py-2.5 rounded-xl text-xs sm:text-sm font-bold transition-all duration-300 ios-btn-active truncate" :class="currentView === 'itinerary' ? 'bg-white text-[#8CA6A4] shadow-sm' : 'text-white/80 hover:text-white'">行程</button>
                    <button @click="currentView = 'booking'" class="flex-1 py-2.5 rounded-xl text-xs sm:text-sm font-bold transition-all duration-300 ios-btn-active truncate mx-1" :class="currentView === 'booking' ? 'bg-white text-[#8CA6A4] shadow-sm' : 'text-white/80 hover:text-white'">預訂</button>
                    <button @click="currentView = 'tools'" class="flex-1 py-2.5 rounded-xl text-xs sm:text-sm font-bold transition-all duration-300 ios-btn-active truncate" :class="currentView === 'tools' ? 'bg-white text-[#8CA6A4] shadow-sm' : 'text-white/80 hover:text-white'">工具箱</button>
                </div>
                <div v-if="currentView === 'booking'" class="flex mt-4 space-x-2 animate-fade-in overflow-x-auto custom-scrollbar pb-1">
                    <button @click="bookingTab = 'flight'" class="px-4 py-1.5 rounded-full text-xs font-bold transition-all border ios-btn-active flex-shrink-0" :class="bookingTab === 'flight' ? 'bg-white text-blue-500 border-white' : 'bg-white/20 text-white border-transparent'"><i class="fa-solid fa-plane-up mr-1"></i> 機票</button>
                    <button @click="bookingTab = 'hotel'" class="px-4 py-1.5 rounded-full text-xs font-bold transition-all border ios-btn-active flex-shrink-0" :class="bookingTab === 'hotel' ? 'bg-white text-purple-500 border-white' : 'bg-white/20 text-white border-transparent'"><i class="fa-solid fa-bed mr-1"></i> 住宿</button>
                    <button @click="bookingTab = 'ticket'" class="px-4 py-1.5 rounded-full text-xs font-bold transition-all border ios-btn-active flex-shrink-0" :class="bookingTab === 'ticket' ? 'bg-white text-green-500 border-white' : 'bg-white/20 text-white border-transparent'"><i class="fa-solid fa-ticket mr-1"></i> 票券</button>
                    <button @click="bookingTab = 'checklist'" class="px-4 py-1.5 rounded-full text-xs font-bold transition-all border ios-btn-active flex-shrink-0" :class="bookingTab === 'checklist' ? 'bg-white text-[#E6A23C] border-white' : 'bg-white/20 text-white border-transparent'"><i class="fa-solid fa-clipboard-list mr-1"></i> 清單</button>
                </div>
                <div v-if="currentView === 'itinerary'" class="flex space-x-3 overflow-x-auto custom-scrollbar pb-2 mt-5">
                    <button v-for="(day, index) in itinerary" :key="index" @click="changeDay(index)" :class="['flex-shrink-0 px-6 py-3 rounded-2xl text-sm font-bold transition-all duration-300 border ios-btn-active', currentDayIndex === index ? 'bg-white text-[#8CA6A4] shadow-md border-transparent scale-105' : 'bg-white/20 text-white border-transparent hover:bg-white/30 backdrop-blur-sm']">{{ day.date }}</button>
                </div>
            </div>
        </header>

        <div class="h-[240px]" :class="currentView === 'tools' ? 'h-[180px]' : 'h-[240px]'"></div>

        <main class="px-5">

            <div v-show="currentView === 'itinerary'" class="animate-fade-in">
                <div class="mb-6 pl-2 border-l-4 border-[#8CA6A4]">
                    <template v-if="!isEditMode">
                        <h2 class="text-2xl font-bold text-gray-800 tracking-tight ml-3">{{ currentDayData.title }}</h2>
                        <p class="text-sm text-gray-500 mt-1 font-medium ml-3">{{ currentDayData.desc }}</p>
                    </template>
                    <template v-else>
                        <input v-model="currentDayData.title" class="edit-input font-bold mb-2 text-lg ml-2" placeholder="行程標題">
                        <input v-model="currentDayData.desc" class="edit-input text-sm ml-2" placeholder="行程簡述">
                    </template>
                </div>
                <div class="space-y-4">
                    <div 
                        v-for="(spot, index) in currentDayData.spots" 
                        :key="index"
                        :draggable="isEditMode"
                        @dragstart="onSpotDragStart($event, index)"
                        @dragover.prevent="onDragEnter($event)"
                        @drop="onSpotDrop($event, index)"
                        @dragend="onDragEnd($event)"
                        @click="!isEditMode ? selectSpot(spot) : null" 
                        :class="['ios-card p-5 relative transition-all duration-300', (!isEditMode && currentSpot && currentSpot.name === spot.name) ? 'ring-2 ring-[#8CA6A4]/50 ring-offset-2 scale-[1.01]' : 'hover:scale-[1.005]', isEditMode ? 'cursor-grab' : 'cursor-pointer ios-btn-active']"
                    >
                        <div v-if="isEditMode" class="absolute -right-2 -top-2 z-10"><button @click.stop="removeSpot(index)" class="btn-delete"><i class="fa-solid fa-xmark text-sm"></i></button></div>
                        <div class="flex items-start gap-4">
                            <div v-if="isEditMode" class="drag-handle self-center -ml-2 mr-1"><i class="fa-solid fa-grip-lines text-gray-300"></i></div>
                            
                            <div class="flex flex-col items-center gap-2 pt-1">
                                <div class="w-10 h-10 rounded-2xl flex items-center justify-center text-white text-lg shadow-md" :class="getIconColor(spot.type)"><i :class="getIcon(spot.type)"></i></div>
                                <span v-if="!isEditMode" class="text-[10px] font-bold text-[#8CA6A4] bg-[#F5F5F0] px-2 py-0.5 rounded-full whitespace-nowrap">{{ spot.time }}</span>
                                <input v-else v-model="spot.time" type="time" class="edit-input w-20 text-[10px] p-1 text-center">
                            </div>
                            <div class="flex-1 min-w-0">
                                <div class="flex justify-between items-start">
                                    <h3 v-if="!isEditMode" class="text-base font-bold text-gray-800 leading-snug truncate pr-2">{{ spot.name }}</h3>
                                    <input v-else v-model="spot.name" class="edit-input font-bold mb-1" placeholder="地點名稱">
                                    <select v-if="isEditMode" v-model="spot.type" class="edit-select"><option v-for="t in spotTypes" :value="t.value">{{ t.label }}</option></select>
                                </div>
                                <p v-if="!isEditMode" class="text-sm text-gray-500 mt-1 leading-relaxed">{{ spot.note }}</p>
                                <input v-else v-model="spot.note" class="edit-input text-sm mt-1" placeholder="備註/筆記">
                                <div v-if="isEditMode" class="mt-2"><input v-model="spot.link" class="edit-input text-xs" placeholder="Google Maps URL"></div>
                                <div v-if="!isEditMode && currentSpot && currentSpot.name === spot.name" class="mt-4 pt-3 border-t border-gray-100 animate-fade-in"><a :href="getNavLink(spot)" target="_blank" @click.stop class="block w-full bg-[#4A5568] text-white text-center py-2.5 rounded-xl text-sm font-semibold shadow-lg shadow-[#4A5568]/20 hover:bg-[#2D3748] transition active:scale-95"><i class="fa-solid fa-location-arrow mr-1.5"></i> 導航 Go</a></div>
                            </div>
                        </div>
                    </div>
                    <button v-if="isEditMode" @click="addSpot" class="btn-add animate-fade-in text-sm"><i class="fa-solid fa-plus mr-1"></i> 新增地點</button>
                </div>
            </div>

            <div v-show="currentView === 'booking'" class="animate-fade-in">
                
                <div v-if="bookingTab === 'flight'" class="space-y-4 pt-2">
                    <div v-for="(booking, index) in flightBookings" :key="index" class="ios-card relative overflow-hidden">
                        <div class="h-2 w-full bg-gradient-to-r from-blue-400 to-blue-600"></div>
                        <div class="p-5">
                            <div v-if="isEditMode" class="absolute right-2 top-2 z-10"><button @click="removeBooking(booking)" class="btn-delete w-6 h-6"><i class="fa-solid fa-xmark text-xs"></i></button></div>
                            <div class="flex justify-between items-center mb-4">
                                <div class="flex items-center gap-2"><i class="fa-solid fa-plane-up text-blue-500 text-xl"></i><input v-if="isEditMode" v-model="booking.title" class="edit-input font-bold text-lg" placeholder="航空公司"><h3 v-else class="text-lg font-bold text-gray-800">{{ booking.title }}</h3></div>
                                <input v-if="isEditMode" v-model="booking.number" class="edit-input w-24 text-right font-mono" placeholder="航班號"><span v-else class="text-sm font-mono font-bold text-gray-500 bg-gray-100 px-2 py-1 rounded">{{ booking.number }}</span>
                            </div>
                            <div class="flex justify-between items-center mb-4 bg-blue-50/50 p-3 rounded-xl border border-blue-100">
                                <div class="text-center flex flex-col items-center"><input v-if="isEditMode" v-model="booking.date" class="edit-input text-xs w-20 text-center mb-1" placeholder="出發"><p v-else class="text-xs text-gray-500 font-bold">{{ booking.date }}</p><input v-if="isEditMode" v-model="booking.dep" class="edit-input text-2xl font-bold text-blue-600 text-center w-20 p-0 bg-transparent uppercase" placeholder="DEP"><p v-else class="text-2xl font-bold text-blue-600 mt-1">{{ booking.dep || 'DEP' }}</p></div>
                                <i class="fa-solid fa-plane text-blue-300 text-xl mx-2"></i>
                                <div class="text-center flex flex-col items-center"><input v-if="isEditMode" v-model="booking.time" class="edit-input text-xs w-20 text-center mb-1" placeholder="抵達"><p v-else class="text-xs text-gray-500 font-bold">{{ booking.time }}</p><input v-if="isEditMode" v-model="booking.arr" class="edit-input text-2xl font-bold text-blue-600 text-center w-20 p-0 bg-transparent uppercase" placeholder="ARR"><p v-else class="text-2xl font-bold text-blue-600 mt-1">{{ booking.arr || 'ARR' }}</p></div>
                            </div>
                            <div class="grid grid-cols-2 gap-4 text-xs text-gray-500">
                                <div><span class="block text-[10px] uppercase text-gray-400 font-bold">備註 / 航廈</span><input v-if="isEditMode" v-model="booking.note" class="edit-input w-full" placeholder="第一航廈..."><p v-else class="font-medium text-gray-700 mt-0.5">{{ booking.note }}</p></div>
                                <div class="text-right"><span class="block text-[10px] uppercase text-gray-400 font-bold">電子機票</span><a v-if="booking.link && booking.link !== '#'" :href="booking.link" target="_blank" class="text-blue-500 font-bold hover:underline mt-0.5 inline-block">查看 PDF <i class="fa-solid fa-arrow-up-right-from-square ml-1"></i></a><input v-if="isEditMode" v-model="booking.link" class="edit-input text-xs mt-1" placeholder="機票連結 URL"></div>
                            </div>
                        </div>
                    </div>
                    <button v-if="isEditMode" @click="addBooking('flight')" class="btn-add animate-fade-in text-sm border-dashed border-2 border-blue-300 text-blue-400 hover:bg-blue-50"><i class="fa-solid fa-plus mr-2"></i> 新增機票</button>
                </div>

                <div v-if="bookingTab === 'hotel'" class="space-y-4 pt-2">
                    <div v-for="(booking, index) in hotelBookings" :key="index" class="ios-card p-0 overflow-hidden flex flex-col">
                        <div class="h-2 w-full bg-gradient-to-r from-purple-400 to-purple-600"></div>
                        <div class="p-5 relative">
                            <div v-if="isEditMode" class="absolute right-2 top-2 z-10"><button @click="removeBooking(booking)" class="btn-delete w-6 h-6"><i class="fa-solid fa-xmark text-xs"></i></button></div>
                            <div class="flex items-start gap-4 mb-3">
                                <div class="w-12 h-12 rounded-2xl bg-purple-100 text-purple-500 flex items-center justify-center text-xl shrink-0"><i class="fa-solid fa-hotel"></i></div>
                                <div class="flex-1 min-w-0"><input v-if="isEditMode" v-model="booking.title" class="edit-input font-bold mb-1" placeholder="飯店名稱"><h3 v-else class="text-lg font-bold text-gray-800 leading-tight">{{ booking.title }}</h3><div class="flex items-center gap-2 mt-1 text-xs text-gray-500"><i class="fa-solid fa-location-dot text-purple-400"></i><input v-if="isEditMode" v-model="booking.note" class="edit-input w-full" placeholder="地址 / 備註"><span v-else class="truncate">{{ booking.note }}</span></div></div>
                            </div>
                            <div class="bg-gray-50 rounded-xl p-3 border border-gray-100 flex justify-between items-center mb-3">
                                <div><span class="text-[10px] text-gray-400 font-bold uppercase">Check-In</span><input v-if="isEditMode" v-model="booking.date" class="edit-input text-xs w-24" placeholder="入住日期"><p v-else class="text-sm font-bold text-gray-700">{{ booking.date }}</p></div>
                                <div class="w-[1px] h-8 bg-gray-200"></div>
                                <div class="text-right"><span class="text-[10px] text-gray-400 font-bold uppercase">Check-Out</span><input v-if="isEditMode" v-model="booking.time" class="edit-input text-xs w-24 text-right" placeholder="退房日期"><p v-else class="text-sm font-bold text-gray-700">{{ booking.time }}</p></div>
                            </div>
                            <div class="flex gap-2"><a :href="getMapSearchUrl(booking.title)" target="_blank" class="flex-1 bg-white border border-gray-200 text-gray-600 py-2 rounded-lg text-xs font-bold text-center hover:bg-gray-50 transition"><i class="fa-solid fa-map mr-1"></i> 地圖</a><a v-if="booking.link && booking.link !== '#'" :href="booking.link" target="_blank" class="flex-1 bg-purple-500 text-white py-2 rounded-lg text-xs font-bold text-center hover:bg-purple-600 transition shadow-sm shadow-purple-200"><i class="fa-solid fa-file-invoice mr-1"></i> 訂房憑證</a><div v-if="isEditMode" class="w-full"><input v-model="booking.link" class="edit-input text-xs h-full" placeholder="訂單連結"></div></div>
                        </div>
                    </div>
                    <button v-if="isEditMode" @click="addBooking('hotel')" class="btn-add animate-fade-in text-sm border-dashed border-2 border-purple-300 text-purple-400 hover:bg-purple-50"><i class="fa-solid fa-plus mr-2"></i> 新增住宿</button>
                </div>

                <div v-if="bookingTab === 'ticket'" class="space-y-4 pt-2">
                    <div v-for="(booking, index) in ticketBookings" :key="index" class="ios-card p-0 overflow-hidden">
                        <div class="h-2 w-full bg-gradient-to-r from-green-400 to-green-600"></div>
                        <div class="p-5 relative">
                            <div v-if="isEditMode" class="absolute right-2 top-2 z-10"><button @click="removeBooking(booking)" class="btn-delete w-6 h-6"><i class="fa-solid fa-xmark text-xs"></i></button></div>
                            <div class="flex justify-between items-start mb-3">
                                <div><input v-if="isEditMode" v-model="booking.title" class="edit-input font-bold mb-1" placeholder="票券名稱"><h3 v-else class="text-lg font-bold text-gray-800">{{ booking.title }}</h3><div class="text-xs text-gray-500 mt-1"><input v-if="isEditMode" v-model="booking.date" class="edit-input w-32" placeholder="使用日期"><span v-else><i class="fa-regular fa-calendar mr-1"></i> {{ booking.date }}</span></div></div>
                                <div class="text-right"><span class="text-[10px] text-gray-400 font-bold uppercase block">備註</span><input v-if="isEditMode" v-model="booking.note" class="edit-input w-20 text-right" placeholder="數量/備註"><span v-else class="text-sm font-bold text-gray-700">{{ booking.note }}</span></div>
                            </div>
                            <div class="bg-gray-100 rounded-xl p-4 flex flex-col items-center justify-center min-h-[150px] border-2 border-dashed border-gray-200 relative group">
                                <template v-if="booking.image"><img :src="booking.image" class="max-h-[200px] object-contain rounded-lg shadow-sm" alt="Ticket QR"><button v-if="isEditMode" @click="triggerImageUpload(booking)" class="absolute bottom-2 right-2 bg-black/50 text-white px-2 py-1 rounded text-xs hover:bg-black/70"><i class="fa-solid fa-pen"></i> 更換</button></template>
                                <template v-else><div class="text-center text-gray-400"><i class="fa-solid fa-qrcode text-3xl mb-2 opacity-50"></i><p class="text-xs">尚無憑證圖片</p><button v-if="isEditMode" @click="triggerImageUpload(booking)" class="mt-2 bg-white border border-gray-300 px-3 py-1 rounded-full text-xs font-bold hover:bg-gray-50">上傳截圖</button></div></template>
                            </div>
                            <div class="mt-3"><a v-if="booking.link && booking.link !== '#'" :href="booking.link" target="_blank" class="block w-full bg-green-500 text-white text-center py-2 rounded-xl text-xs font-bold shadow-sm shadow-green-200 hover:bg-green-600 transition"><i class="fa-solid fa-mobile-screen-button mr-1.5"></i> 開啟 APP / 原始連結</a><input v-if="isEditMode" v-model="booking.link" class="edit-input text-xs w-full mt-2" placeholder="APP Scheme 或 購票連結"></div>
                        </div>
                    </div>
                    <button v-if="isEditMode" @click="addBooking('ticket')" class="btn-add animate-fade-in text-sm border-dashed border-2 border-green-300 text-green-500 hover:bg-green-50"><i class="fa-solid fa-plus mr-2"></i> 新增票券</button>
                </div>

                <div v-if="bookingTab === 'checklist'" class="space-y-4 pt-2 pb-4">
                    <div v-for="(category, cIndex) in checklistData" :key="cIndex" class="ios-card p-0 overflow-hidden flex flex-col relative transition-all duration-300 hover:shadow-md">
                        <div class="h-2 w-full bg-gradient-to-r from-orange-400 to-orange-600"></div>
                        <div class="p-5">
                            <div class="flex justify-between items-center mb-4 pb-2 border-b border-gray-100">
                                <h3 class="font-bold text-gray-800 flex items-center text-base">
                                    <div class="w-8 h-8 rounded-lg bg-orange-100 text-orange-500 flex items-center justify-center mr-2"><i class="fa-solid fa-list-ul text-sm"></i></div>
                                    {{ category.title }}
                                </h3>
                                <span class="text-[10px] font-bold text-white bg-orange-500 px-2 py-1 rounded-full shadow-sm shadow-orange-200">{{ category.items.filter(i => i.checked).length }} / {{ category.items.length }}</span>
                            </div>
                            <div class="space-y-3">
                                <div 
                                    v-for="(item, iIndex) in category.items" 
                                    :key="iIndex"
                                    :draggable="isEditMode"
                                    @dragstart="onChecklistDragStart($event, cIndex, iIndex)"
                                    @dragover.prevent="onDragEnter($event)"
                                    @drop="onChecklistDrop($event, cIndex, iIndex)"
                                    @dragend="onDragEnd($event)"
                                    class="flex items-center group"
                                    :class="isEditMode ? 'cursor-grab' : ''"
                                >
                                    <div v-if="isEditMode" class="drag-handle mr-2 text-gray-300 hover:text-orange-400"><i class="fa-solid fa-grip-lines"></i></div>
                                    <div @click="!isEditMode ? toggleChecklistItem(cIndex, iIndex) : null" class="w-5 h-5 rounded-full border-2 flex items-center justify-center mr-3 transition-colors duration-200 flex-shrink-0 cursor-pointer" :class="[item.checked ? 'bg-orange-500 border-orange-500' : 'border-gray-300 group-hover:border-orange-400']"><i v-if="item.checked" class="fa-solid fa-check text-white text-[10px]"></i></div>
                                    <span v-if="!isEditMode" @click="toggleChecklistItem(cIndex, iIndex)" class="text-sm transition-colors duration-200 flex-1 cursor-pointer" :class="item.checked ? 'text-gray-400 line-through' : 'text-gray-700 font-medium'">{{ item.name }}</span>
                                    <input v-else v-model="item.name" class="flex-1 edit-input text-sm py-1" placeholder="項目名稱">
                                    <button v-if="isEditMode" @click="removeChecklistItem(cIndex, iIndex)" class="ml-2 text-red-400 hover:text-red-600 w-6 h-6 flex items-center justify-center transition"><i class="fa-solid fa-minus-circle"></i></button>
                                </div>
                            </div>
                            <div v-if="isEditMode" class="mt-4 pt-2 border-t border-gray-100/50"><button @click="addChecklistItem(cIndex)" class="w-full py-2 text-xs font-bold text-orange-500 border border-dashed border-orange-300 rounded-lg hover:bg-orange-50 transition"><i class="fa-solid fa-plus mr-1"></i> 新增項目</button></div>
                        </div>
                    </div>
                </div>
            </div>

            <div v-show="currentView === 'tools'" class="space-y-5 animate-fade-in pt-2">
                <div class="ios-card p-5 flex items-center justify-between">
                    <div class="flex items-center gap-3">
                        <div class="w-10 h-10 rounded-2xl bg-gradient-to-br from-blue-400 to-blue-600 text-white flex items-center justify-center text-lg shadow-md shadow-blue-200"><i class="fa-solid fa-language"></i></div>
                        <div><h3 class="font-bold text-gray-800 text-sm">Google 翻譯</h3><p class="text-[10px] text-gray-400 font-medium">中日互譯 / 語音輸入</p></div>
                    </div>
                    <a href="https://translate.google.com/?sl=zh-TW&tl=ja&op=translate" target="_blank" class="bg-[#F2F2F7] text-blue-600 px-4 py-2 rounded-full text-xs font-bold hover:bg-[#E5E5EA] transition ios-btn-active">開啟</a>
                </div>
                <div class="ios-card p-6">
                    <div class="flex justify-between items-center mb-4"><h3 class="font-bold text-gray-700 flex items-center gap-2"><i class="fa-solid fa-coins text-[#BCAAA4]"></i> 匯率試算</h3><div class="flex items-center bg-[#F5F5F0] rounded-lg px-2 py-1"><span class="text-[10px] text-gray-400 mr-1">Rate:</span><input v-model="exchangeRate" class="w-12 bg-transparent text-xs font-bold text-gray-600 text-center outline-none" type="number" step="0.001"></div></div>
                    <div class="grid grid-cols-[1fr_auto_1fr] gap-3 items-center"><div class="bg-[#F9F9F9] p-3 rounded-2xl border border-gray-100 focus-within:ring-2 focus-within:ring-[#8CA6A4]/20 transition-all"><label class="text-[10px] font-bold text-gray-400 uppercase block mb-1">JPY (¥)</label><input type="number" v-model="jpyAmount" @input="calculateTWD" class="w-full bg-transparent text-xl font-bold text-gray-800 outline-none placeholder-gray-300" placeholder="0"></div><i class="fa-solid fa-arrow-right-arrow-left text-gray-300 text-sm"></i><div class="bg-[#F9F9F9] p-3 rounded-2xl border border-gray-100 focus-within:ring-2 focus-within:ring-[#8CA6A4]/20 transition-all"><label class="text-[10px] font-bold text-gray-400 uppercase block mb-1">TWD ($)</label><input type="number" v-model="twdAmount" @input="calculateJPY" class="w-full bg-transparent text-xl font-bold text-gray-800 outline-none placeholder-gray-300" placeholder="0"></div></div>
                </div>
                <div class="ios-card p-6">
                    <h3 class="font-bold text-gray-700 mb-4 flex items-center gap-2"><i class="fa-solid fa-users-viewfinder text-[#8CA6A4]"></i> AA 分帳</h3>
                    <div class="flex gap-3 mb-4"><div class="flex-1"><label class="text-[10px] text-gray-400 font-bold block mb-1 pl-1">總金額</label><input type="number" v-model="billTotal" class="w-full bg-[#F9F9F9] p-3 rounded-xl border border-gray-100 font-bold text-gray-700 outline-none focus:ring-2 focus:ring-[#8CA6A4]/20" placeholder="¥"></div><div class="w-24"><label class="text-[10px] text-gray-400 font-bold block mb-1 pl-1">人數</label><input type="number" v-model="headCount" class="w-full bg-[#F9F9F9] p-3 rounded-xl border border-gray-100 font-bold text-gray-700 outline-none text-center" placeholder="7"></div></div>
                    <div class="bg-[#F5F5F0] p-4 rounded-xl flex justify-between items-center"><span class="text-xs text-gray-500 font-medium">每人應付</span><span class="text-2xl font-bold text-[#4A5568]">{{ splitResult }}</span></div>
                </div>
                <div class="ios-card overflow-hidden"><div class="p-4 pb-0"><h3 class="font-bold text-gray-700 flex items-center gap-2"><i class="fa-solid fa-cloud-sun text-[#9FB3C8]"></i> 大阪天氣</h3></div><div class="p-2"><a class="weatherwidget-io" href="https://forecast7.com/zh-tw/34d69135d50/osaka/" data-label_1="OSAKA" data-label_2="大阪" data-font="Noto Sans TC" data-icons="Climacons Animated" data-mode="Current" data-days="3" data-theme="pure" data-basecolor="rgba(255,255,255,0)" data-textcolor="#4A5568" >OSAKA 大阪天氣</a></div></div>
            </div>
        </main>

        <div v-if="currentSpot && !isEditMode && currentView === 'itinerary'" class="fixed bottom-0 w-full max-w-md md:max-w-xl bg-white/90 backdrop-blur-xl shadow-[0_-10px_40px_rgba(0,0,0,0.1)] rounded-t-[30px] z-50 transition-transform duration-500 cubic-bezier(0.32, 0.72, 0, 1)" :class="isMapExpanded ? 'translate-y-0' : 'translate-y-[calc(100%-80px)]'">
            <div @click="isMapExpanded = !isMapExpanded" class="w-full pt-3 pb-4 cursor-pointer">
                <div class="w-12 h-1.5 bg-gray-300 rounded-full mx-auto mb-3"></div>
                <div class="px-6 flex justify-between items-center">
                    <div class="flex items-center gap-2 text-sm font-bold text-gray-700"><i class="fa-solid fa-map-pin text-[#8CA6A4]"></i><span class="truncate max-w-[200px]">{{ currentSpot.name }}</span></div>
                    <div class="w-8 h-8 rounded-full bg-gray-100 flex items-center justify-center text-gray-500 transition-transform duration-300" :class="isMapExpanded ? 'rotate-180' : ''"><i class="fa-solid fa-chevron-up text-xs"></i></div>
                </div>
            </div>
            <div class="px-4 pb-8 h-[250px] bg-white"><iframe width="100%" height="100%" frameborder="0" style="border:0; border-radius: 20px;" :src="getMapUrl(currentSpot.name)" allowfullscreen></iframe></div>
        </div>

    </div>
    
    <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src='https://weatherwidget.io/js/widget.min.js';fjs.parentNode.insertBefore(js,fjs);}}(document,'script','weatherwidget-io-js');</script>
    <script src="script.js"></script>
</body>
</html>